<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´í•œ ìŠ¤í¬ë¡¤ ì‹¤ìŠµ</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 0; background-color: #f9f9f9; }
        header { background-color: #333; color: white; padding: 1rem; text-align: center; position: fixed; top: 0; width: 100%; z-index: 100; }
        .content-area { max-width: 800px; margin: 80px auto 20px; padding: 20px; }
        
        /* Selenium Target Class: .product-item */
        .product-item {
            background: white; border: 1px solid #ddd; border-radius: 8px;
            margin-bottom: 20px; padding: 20px; display: flex; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.2s;
        }
        .product-item:hover { transform: translateY(-3px); }
        .circle { width: 50px; height: 50px; background-color: #3498db; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 20px; flex-shrink: 0; }
        .info h3 { margin: 0 0 5px 0; color: #333; }
        .info p { margin: 0; color: #666; font-size: 0.9em; }
        .price { margin-left: auto; font-weight: bold; color: #e74c3c; font-size: 1.2em; }
        
        #loader { text-align: center; padding: 20px; display: none; }
        .end-msg { text-align: center; color: #888; padding: 30px; font-weight: bold; display: none; }
    </style>
</head>
<body>
    <header>
        <h1>ë¬´í•œ ìŠ¤í¬ë¡¤ ë°ì´í„° ìˆ˜ì§‘ (Page <span id="page-num">1</span>)</h1>
    </header>

    <div class="content-area" id="container">
        <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì•„ì´í…œì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
    </div>

    <div id="loader">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘... â³</div>
    <div id="end-message" class="end-msg">ëª¨ë“  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ‰</div>

    <script>
        let page = 1;
        let isLoading = false;
        let isFinished = false;
        const container = document.getElementById('container');
        const loader = document.getElementById('loader');
        const endMsg = document.getElementById('end-message');
        const pageNumDisplay = document.getElementById('page-num');

        async function loadItems() {
            if (isLoading || isFinished) return;
            
            isLoading = true;
            loader.style.display = 'block';

            try {
                let items = [];

                // ğŸ› ï¸ í™˜ê²½ ê°ì§€: ë¯¸ë¦¬ë³´ê¸°(blob) í™˜ê²½ì¸ì§€ í™•ì¸
                // ì´ ì½”ë“œê°€ ì—†ìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ fetch ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
                const isPreview = window.location.protocol === 'blob:' || window.location.protocol === 'file:';

                if (isPreview) {
                    console.log("âš ï¸ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ: ë°±ì—”ë“œ ì—†ì´ ê°€ì§œ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.");
                    // ì‹¤ì œ APIì²˜ëŸ¼ 0.5ì´ˆ ë”œë ˆì´ ì‹œë®¬ë ˆì´ì…˜
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    if (page > 10) {
                        items = [];
                    } else {
                        // ë°±ì—”ë“œ ë°ì´í„° êµ¬ì¡°ì™€ ë™ì¼í•˜ê²Œ ê°€ì§œ ë°ì´í„° ìƒì„±
                        const startId = (page - 1) * 6 + 1;
                        items = Array.from({length: 6}, (_, i) => {
                            const id = startId + i;
                            return {
                                id: id,
                                title: `[ì‹¤ìŠµ] í¬ë¡¤ë§ ì—°ìŠµ ìƒí’ˆ ${id}`,
                                price: id * 1500,
                                description: `ì´ ìƒí’ˆì€ ${id}ë²ˆì§¸ ë°ì´í„°ì…ë‹ˆë‹¤. ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ë³´ì„¸ìš”.`
                            };
                        });
                    }
                } else {
                    // âœ… ì‹¤ì œ ë°°í¬ í™˜ê²½ (Render ë“±): FastAPI ë°±ì—”ë“œ í˜¸ì¶œ
                    const response = await fetch(`/api/items?page=${page}`);
                    items = await response.json();
                }

                if (items.length === 0) {
                    isFinished = true;
                    loader.style.display = 'none';
                    endMsg.style.display = 'block';
                    return;
                }

                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'product-item'; // Selenium Target Class
                    div.innerHTML = `
                        <div class="circle">${item.id}</div>
                        <div class="info">
                            <h3>${item.title}</h3>
                            <p>${item.description}</p>
                        </div>
                        <div class="price">${item.price.toLocaleString()}ì›</div>
                    `;
                    container.appendChild(div);
                });

                page++;
                pageNumDisplay.innerText = page - 1;

            } catch (err) {
                console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", err);
                loader.innerHTML = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”)";
            } finally {
                isLoading = false;
                loader.style.display = 'none';
            }
        }

        // ì´ˆê¸° ë¡œë”©
        loadItems();

        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ê°ì§€
        window.addEventListener('scroll', () => {
            // ë¬¸ì„œ ì „ì²´ ë†’ì´ - (í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ + í™”ë©´ ë†’ì´) < 100px ì¼ ë•Œ ë¡œë”©
            if (document.documentElement.offsetHeight - (window.scrollY + window.innerHeight) < 100) {
                loadItems();
            }
        });
    </script>
</body>
</html>